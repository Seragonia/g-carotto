<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}">
  <link rel="stylesheet" href="{{ '/sass/style.css' | relative_url }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
  <link rel="icon" href="{{ '/assets/images/favicon.ico' | relative_url }}">
  <style>
    .search-form {
      position: relative;
    }
    
    .search-toggle {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      padding: 8px;
      font-size: 18px;
    }
    
    .search-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background-color: #fff;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 10px;
      display: none;
      z-index: 100;
      min-width: 280px;
    }
    
    .search-dropdown.active {
      display: block;
    }
    
    .search-dropdown form {
      display: flex;
      width: 100%;
    }
    
    .search-dropdown input[type="search"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px 0 0 4px;
    }
    
    .search-dropdown button {
      background: #ff7f00;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <div class="header-container">
        <div class="site-logo">
          <a href="{% include localized_url.html url='/' %}">
            <img src="{{ '/assets/images/logo.png' | relative_url }}" alt="{{ site.title }}" style="width: 172px; height: auto;">
          </a>
        </div>
        
        <div class="language-selector">
          <button class="language-current">
            <img src="{{ '/assets/images/flags/' | append: site.active_lang | append: '.png' | relative_url }}" 
                alt="{{ site.data.translations[site.active_lang].lang_name | default: site.active_lang }}">
            <i class="fas fa-chevron-down language-arrow"></i>
          </button>
          <div class="language-dropdown">
            {% for lang in site.languages %}
              {% if lang == 'fr' %}
                <!-- French link with JavaScript to force navigation to root -->
                <a href="javascript:void(0)" onclick="window.location.href='/'" class="{% if site.active_lang == lang %}active{% endif %}" data-lang="{{ lang }}">
              {% else %}
                <a href="{% include localized_url.html lang=lang url=page.url %}" class="{% if site.active_lang == lang %}active{% endif %}" data-lang="{{ lang }}">
              {% endif %}
                <img src="{{ '/assets/images/flags/' | append: lang | append: '.png' | relative_url }}" 
                     alt="{{ site.data.translations[lang].lang_name | default: lang }}">
                {% if lang == 'fr' %}
                  <span>Français</span>
                {% elsif lang == 'en' %}
                  <span>English</span>
                {% elsif lang == 'es' %}
                  <span>Español</span>
                {% elsif lang == 'de' %}
                  <span>Deutsch</span>
                {% elsif lang == 'zh' %}
                  <span>中文</span>
                {% elsif lang == 'id' %}
                  <span>Bahasa Indonesia</span>
                {% elsif lang == 'fil' %}
                  <span>Filipino</span>
                {% else %}
                  <span>{{ site.data.translations[lang].lang_name | default: lang }}</span>
                {% endif %}
              </a>
            {% endfor %}
          </div>
        </div>
        
        <nav class="main-navigation">
          <ul>
            {% for section_entry in site.data.pages %}
              {% assign section_key = section_entry[0] %}
              {% assign section_data = section_entry[1] %}
              <li class="{% if page.url contains section_key %}active{% endif %}">
                {% assign section_title = section_data.title[site.active_lang] | default: section_data.title['en'] %}
                
                <a href="{% include localized_url.html url=section_key %}">{{ section_title }}</a>
                {% if section_data.subSections and section_data.subSections.size > 0 %}
                  <ul class="sub-menu">
                    {% for subsection_entry in section_data.subSections %}
                      {% assign subsection_key = subsection_entry[0] %}
                      {% assign subsection_data = subsection_entry[1] %}
                      <li class="{% if page.url contains subsection_key %}active{% endif %}">
                        {% assign subsection_title = subsection_data[site.active_lang] | default: subsection_data['en'] %}
                        {% capture subsection_url %}{{ section_key }}/{{ subsection_key }}/{% endcapture %}
                        <a href="{{ subsection_url | prepend: '/' }}">{{ subsection_title }}</a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </nav>
        
        <div class="search-form">
          <button type="button" class="search-toggle" aria-label="{{ site.data.translations[site.active_lang].search | default: site.data.translations['en'].search }}">
            <i class="fas fa-search"></i>
          </button>
          <div class="search-dropdown">
            <form action="{{ '/search/' | relative_url }}" method="get">
              <input type="search" name="q" placeholder="{{ site.data.translations[site.active_lang].search | default: site.data.translations['en'].search }}" aria-label="{{ site.data.translations[site.active_lang].search | default: site.data.translations['en'].search }}">
              <button type="submit"><i class="fas fa-search"></i></button>
            </form>
          </div>
        </div>
        
        <button class="nav-toggle" aria-label="Toggle navigation">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </div>
  </header>
  
  <!-- Submenu bar (shown only when in a parent section) -->
  {% assign current_section = page.url | split: '/' | slice: 1 | first %}
  {% for section_entry in site.data.pages %}
    {% assign section_key = section_entry[0] %}
    {% assign section_data = section_entry[1] %}
    {% if current_section == section_key and section_data.subSections.size > 0 %}
    <div class="current-submenu-bar">
      <div class="container">
        <ul>
          {% for subsection_entry in section_data.subSections %}
            {% assign subsection_key = subsection_entry[0] %}
            {% assign subsection_data = subsection_entry[1] %}
            <li class="{% if page.url contains subsection_key %}active{% endif %}">
              {% assign subsection_title = subsection_data[site.active_lang] | default: subsection_data['en'] %}
              {% capture subsection_url %}{{ section_key }}/{{ subsection_key }}/{% endcapture %}
              <a href="{{ subsection_url | prepend: '/' }}">{{ subsection_title }}</a>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}
  {% endfor %}
  
  <!-- Mobile Menu -->
  <div class="mobile-menu">
    <ul>
      <!-- Don't show explicit Home/Accueil if it's already in the menu -->
      {% if home_in_menu == false %}
      <li class="{% if page.url == '/' or page.url == '/home/' %}active{% endif %}">
        {% assign home_title = site.data.translations[site.active_lang].home | default: site.data.translations['en'].home %}
        {% if site.data.content['0-home'] and site.data.content['0-home'].translations.title[site.active_lang] %}
          {% assign home_title = site.data.content['0-home'].translations.title[site.active_lang] %}
        {% endif %}
        <a href="{% include localized_url.html url='/' %}">{{ home_title }}</a>
      </li>
      {% endif %}
      
      {% for section_entry in site.data.pages %}
        {% assign section_key = section_entry[0] %}
        {% assign section_data = section_entry[1] %}
        <li class="menu-item-has-children {% if page.url contains section_key %}active{% endif %}">
          {% assign section_title = section_data.title[site.active_lang] | default: section_data.title['en'] %}
          
          <a href="{% include localized_url.html url=section_key %}">{{ section_title }}</a>
          {% if section_data.subSections and section_data.subSections.size > 0 %}
            <ul class="sub-menu {% if page.url contains section_key %}active{% endif %}">
              {% for subsection_entry in section_data.subSections %}
                {% assign subsection_key = subsection_entry[0] %}
                {% assign subsection_data = subsection_entry[1] %}
                <li class="{% if page.url contains subsection_key %}active{% endif %}">
                  {% assign subsection_title = subsection_data[site.active_lang] | default: subsection_data['en'] %}
                  {% capture subsection_url %}{{ section_key }}/{{ subsection_key }}/{% endcapture %}
                  <a href="{{ subsection_url | prepend: '/' }}">{{ subsection_title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
  
  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      {{ content }}
    </div>
  </main>
  
  <!-- Scroll to top button -->
  <button class="scroll-to-top" aria-label="{{ site.data.translations[site.active_lang].back_to_top | default: site.data.translations['en'].back_to_top | default: 'Back to top' }}">
    <i class="fas fa-arrow-up"></i>
  </button>
  
  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="footer-widgets">
        <div class="footer-widget footer-about">
          <h3>{{ site.data.translations[site.active_lang].about | default: site.data.translations['en'].about }}</h3>
          <img src="{{ '/assets/images/logo.png' | relative_url }}" alt="{{ site.title }}">
          <p>{{ site.data.translations[site.active_lang].site_description | default: site.data.translations['en'].site_description }}</p>
          <div class="footer-social">
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" aria-label="Discord"><i class="fab fa-discord"></i></a>
            <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
      </div>
      
      <div class="footer-bottom">
        <div class="footer-copyright">
          &copy; {{ site.time | date: '%Y' }} {{ site.title }} – {{ site.data.translations[site.active_lang].all_rights_reserved | default: site.data.translations['en'].all_rights_reserved }}
        </div>
        <div class="footer-menu">
          <ul>
            <li><a href="{{ '/mentions-legales/' | relative_url }}">{{ site.data.translations[site.active_lang].legal_notice | default: site.data.translations['en'].legal_notice }}</a></li>
            <li><a href="{{ '/politique-confidentialite/' | relative_url }}">{{ site.data.translations[site.active_lang].privacy_policy | default: site.data.translations['en'].privacy_policy }}</a></li>
            <li><a href="{{ '/contact/' | relative_url }}">{{ site.data.translations[site.active_lang].contact | default: site.data.translations['en'].contact }}</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>
  
  <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuToggle = document.querySelector('.nav-toggle');
      const mobileMenu = document.querySelector('.mobile-menu');
      const menuItemsWithChildren = document.querySelectorAll('.menu-item-has-children');
      const searchToggle = document.querySelector('.search-toggle');
      const searchDropdown = document.querySelector('.search-dropdown');
      
      if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', function() {
          mobileMenu.classList.toggle('active');
        });
      }
      
      if (searchToggle && searchDropdown) {
        searchToggle.addEventListener('click', function() {
          searchDropdown.classList.toggle('active');
          if (searchDropdown.classList.contains('active')) {
            searchDropdown.querySelector('input[type="search"]').focus();
          }
        });
        
        document.addEventListener('click', function(event) {
          if (!searchToggle.contains(event.target) && !searchDropdown.contains(event.target)) {
            searchDropdown.classList.remove('active');
          }
        });
      }
      
      menuItemsWithChildren.forEach(function(item) {
        const link = item.querySelector('a');
        
        if (link) {
          link.addEventListener('click', function(e) {
            if (window.innerWidth <= 1024) {
              e.preventDefault();
              const subMenu = this.nextElementSibling;
              if (subMenu) {
                subMenu.classList.toggle('active');
                item.classList.toggle('active');
              }
            }
          });
        }
      });
      
      document.querySelectorAll('li.active').forEach(function(li) {
        if (!li.textContent.trim() && !li.querySelector('a[href]')) {
          li.remove();
        }
      });
    });
  </script>
</body>
</html> 